<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>WebStamp.my - Digital Company Stamp Generator</title>
  <meta name="description" content="Digital Company Stamp Generator built for Malaysia." />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="icon" href="favicon.ico" />
  <link rel="stylesheet" href="styles.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
</head>

<body>
  <header class="header" style="position:relative;">
    <div class="header-inner">
      <a class="logo" href="#">
        <img src="logo_stamp.png" alt="WebStamp.my Logo" style="width:50px;height:50px;" />
        <div style="display:flex;flex-direction:column;line-height:1.3">
          <div>WebStamp.my</div>
          <div class="tagline">Digital Company Stamp</div>
        </div>
      </a>

      <div class="header-right">
        <nav class="nav desktop-only">
         <a href="index.html" class="active" 
           style="color:#2563eb;font-weight:600;">Free PDF Stamp</a>
          <a href="pdf.html">Free PDF Signiture</a>
        </nav>

        <div class="divider desktop-only"></div>

        <button id="hamburger" class="hamburger mobile-only" aria-label="Toggle menu">‚ò∞</button>
      </div>

      <div id="mobile-menu" class="mobile-nav" style="display:none;">
        <a href="free-stamp.php" class="active" 
           style="color:#2563eb;font-weight:600;">Free Stamp</a>
      </div>
    </div>
  </header>

  <main class="container">
    <div class="hero" style="margin-top:40px;margin-bottom:40px;">
      <h1>Create Your Digital Company Stamp Instantly</h1>
      <p style="margin-top:15px;color:#556178;">
        No physical stamp. Instant generation with SSM No. and address. Preview below or on the right; download clean version for free.
      </p>
    </div>

    <div class="grid-2" style="align-items:start;">
      <div class="card">
        <div style="margin-bottom:16px;">
          <div style="font-size:20px;font-weight:700;">Generate Your Stamp</div>
          <div style="font-size:14px;color:#556178;margin-top:4px;">
            No login needed. Design is final once downloaded.
          </div>
        </div>

        <form id="stamp-form" style="display:grid;gap:1rem;">
          <div>
            <label class="field-label">Template</label>
            <select name="template" class="input">
              <option value="round">üåÄ Round Stamp</option>
              <option value="box">üß± Box Stamp</option>
              <option value="info">üì¶ Info Stamp</option>
            </select>
          </div>

          <div class="template-fields" data-for="round">
            <label class="field-label">Company Name</label>
            <input class="input" name="companyName" value="Web Impian Sdn. Bhd." />

            <label class="field-label">Company No. (New)</label>
            <input class="input" name="ssmNoNew" value="201001036239" />

            <label class="field-label">Company No. (Old)</label>
            <input class="input" name="ssmNoOld" value="920163-H" />
          </div>

          <div class="template-fields" data-for="box">
            <label class="field-label">Company Name</label>
            <input class="input" name="companyName" value="Web Impian Sdn. Bhd." />

            <label class="field-label">Company No. (New)</label>
            <input class="input" name="ssmNoNew" value="201001036239" />
            <input class="input" name="ssmNoOld" value="920163-H" style="display:none;" />

            <label class="field-label">Address</label>
            <input class="input" name="address1" value="Tingkat 1, Kota Kenangan, PT 2499" placeholder="Address Line 1" />
            <input class="input" name="address2" value="Jalan Hospital, Taman Kenangan" placeholder="Address Line 2" />
            <input class="input" name="address3" value="15200 Kota Bharu, Kelantan" placeholder="Address Line 3" />
          </div>

          <div class="template-fields" data-for="info">
            <label class="field-label">Company Name</label>
            <input class="input" name="companyName" value="Web Impian Sdn. Bhd." />

            <label class="field-label">Company No. (New)</label>
            <input class="input" name="ssmNoNew" value="202401234567" />
            <input class="input" name="ssmNoOld" value="920163-H" style="display:none;" />

            <label class="field-label">Address</label>
            <input class="input" name="address1" value="Tingkat 1, Kota Kenangan, PT 2499" />
            <input class="input" name="address2" value="Jalan Hospital, Taman Kenangan" />
            <input class="input" name="address3" value="15200 Kota Bharu, Kelantan" />

            <label class="field-label">Telephone</label>
            <input class="input" name="phone" value="09-7405500" />

            <label class="field-label">Email (shown on stamp)</label>
            <input class="input" name="email" value="hai@webimpian.com" />
          </div>

          <div>
            <label class="field-label">Billing Email (required for download)</label>
            <input class="input" name="billingEmail" placeholder="billing@email.com" />
          </div>

          <div>
            <label class="field-label">Stamp Colour</label>
            <div style="display:flex;gap:8px;">
              <button type="button" data-color="black" data-active="1" class="btn btn-outline" style="flex:1;">Black</button>
              <button type="button" data-color="red" class="btn btn-outline" style="flex:1;">Red</button>
              <button type="button" data-color="blue" class="btn btn-outline" style="flex:1;">Blue</button>
            </div>
          </div>

          <div style="display:grid;gap:12px;grid-template-columns:1fr 1fr;margin-top:4px;">
            <!-- Free Download Button -->
            <button type="button" id="btn-download-free" class="btn btn-outline">
              Download Free
            </button>

            <!-- HD Download Button -->
            <button type="button" id="btn-download-hd" class="btn btn-primary">
              Download HD (RM3)
            </button>
          </div>

          <!-- Physical Stamp Button -->
          <div style="margin-top:8px;border-top:1px solid #e5e7eb;padding-top:16px;">
            <button type="button" id="btn-physical-stamp" class="btn btn-secondary" style="width:100%;padding:14px;font-weight:600;display:flex;align-items:center;justify-content:center;gap:8px;">
              <span style="font-size:18px;">üñ®Ô∏è</span>
              <span>Order Physical Stamp</span>
            </button>
            <small class="text-muted" style="display:block;text-align:center;margin-top:6px;font-size:12px;">
              Get your stamp physically delivered to your address
            </small>
          </div>
        </form>
      </div>

      <div class="card">
        <div style="display:flex;justify-content:space-between;margin-bottom:12px;">
          <div style="font-weight:600;">Live Preview</div>
          <div style="font-size:12px;color:#6b7280;">Looks like your real stamp</div>
        </div>
        <div id="stamp-preview" style="padding:1rem 0;display:flex;justify-content:center;"></div>
        <div class="small">Vector-based; sharp on any document. Free version includes watermark.</div>
        <div style="margin-top:8px;background:#eef4ff;padding:8px 12px;border-radius:8px;font-size:12px;color:#374151;text-align:center;">
          Fill details and click download.
        </div>
      </div>
    </div>
  </main>

  <footer class="footer">
    <div class="footer-inner">
      <div>
        <div class="footer-title">WebStamp.my</div>
        <div class="small">Digital Company Stamp Generator built for Malaysia.</div>
      </div>

      <div class="footer-section">
        <div class="footer-title">Product</div>
        <a href="index.html">Free PDF Stamp</a>
        <a href="pdf.html">Free PDF Signiture</a>
      </div>

      <div class="footer-section">
        <div class="footer-title">Company</div>
        <a href="https://webimpian.com/">Web Impian Sdn. Bhd.</a>
        <a href="https://main.bcl.my/">bcl.my</a>
      </div>

      <div class="footer-section">
        <div class="footer-title">Support</div>
        <div class="footer-note">
          ¬© 2025 WebStamp.my <br>
          <span style="color:#6b7280;"></span>
        </div>
      </div>
    </div>
  </footer>

  <!-- BCL Payment Modal -->
<div id="bcl-payment-modal" class="payment-modal">
  <div class="payment-modal-content">
    <div class="payment-modal-header">
      <div>
        <h3>Unlock HD Download</h3>
        <p class="modal-subtitle">Complete payment to download HD version</p>
      </div>
      <button id="close-bcl-modal" class="modal-close-btn">√ó</button>
    </div>
    
    <!-- BCL Embed Form Container -->
    <div id="bcl-embed-container" style="padding: 24px; min-height: 400px;">
      <!-- The BCL form will load here -->
      <div style="text-align: center; padding: 40px;">
        <div class="spinner"></div>
        <p>Loading secure payment form...</p>
      </div>
    </div>
    
    <!-- Hidden container for BCL embed code -->
    <div id="bcl-payment-form" data-url="https://intern.bcl.my/embed/form/webcop-hd-version"></div>

    <script src="https://bcl.my/js/bc-encrypted-payment-embed.js"></script>
  </div>
</div>

  <script src="https://cdn.jsdelivr.net/npm/dom-to-image-more@3.5.0/dist/dom-to-image-more.min.js"></script>
  <script src="main.js"></script>
  
  <!-- Add this script for the physical stamp button -->
  <script>
    // Physical Stamp Button Handler
    document.addEventListener('DOMContentLoaded', function() {
      const physicalStampBtn = document.getElementById('btn-physical-stamp');
      
      if (physicalStampBtn) {
        physicalStampBtn.addEventListener('click', function() {
          orderPhysicalStamp();
        });
      }
      
      function orderPhysicalStamp() {
        const form = document.getElementById('stamp-form');
        const billingEmail = form.querySelector('[name="billingEmail"]').value;
        const d = readForm();
        
        // Validate email
        if (!billingEmail) {
          alert('Please enter your billing email to proceed with physical stamp order.');
          form.querySelector('[name="billingEmail"]').focus();
          return;
        }
        
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(billingEmail)) {
          alert('Please enter a valid email address.');
          return;
        }
        
        if (!d.companyName || d.companyName.trim() === '') {
          alert('Please enter your company name for the physical stamp.');
          form.querySelector('[name="companyName"]').focus();
          return;
        }
        
        // Validate shipping address for physical stamp
        if (!d.address[0] || d.address[0].trim() === '') {
          alert('Please enter your shipping address for physical stamp delivery.');
          form.querySelector('[name="address1"]').focus();
          return;
        }
        
        // Create unique order reference
        const timestamp = Date.now();
        const shortHash = Math.random().toString(36).substring(2, 10).toUpperCase();
        const orderRef = `PHYSICAL_${timestamp}_${shortHash}`;
        
        console.log('üì¶ Preparing PHYSICAL stamp data for BCL...');
        
        // Create COMPLETE stamp data with ALL fields including address
        const stampData = {
          // Company details
          cn: (d.companyName || '').trim(),
          sn: (d.ssmNo || '').trim(),
          so: (d.ssmNoOld || '').trim(),
          
          // Design details
          t: d.template || 'round',
          c: d.color || 'black',
          
          // Contact details
          e: billingEmail.trim(),
          p: (d.phone || '').trim(),
          
          // SHIPPING ADDRESS (for delivery)
          a1: (d.address[0] || '').trim(),
          a2: (d.address[1] || '').trim(),
          a3: (d.address[2] || '').trim(),
          
          // Additional email if provided
          em: (d.email || '').trim(),
          
          // Order metadata
          ts: timestamp,
          or: orderRef,
          type: 'physical'
        };
        
        console.log('Physical stamp data prepared:', stampData);
        
        // Convert to JSON and encode with Base64
        const stampDataString = JSON.stringify(stampData);
        console.log('JSON size:', stampDataString.length, 'characters');
        
        // Base64 encode (URL safe)
        const encodedStampData = btoa(encodeURIComponent(stampDataString));
        console.log('Base64 size:', encodedStampData.length, 'characters');
        
        // Create special email format: real-email#ENCODED_DATA
        const specialEmail = `${billingEmail}#${encodedStampData}`;
        console.log('Special email created (first 100 chars):', specialEmail.substring(0, 100));
        
        // Save to sessionStorage as backup
        sessionStorage.setItem(`stamp_${orderRef}`, stampDataString);
        console.log('Saved to sessionStorage with key:', `stamp_${orderRef}`);
        
        // Build BCL redirect URL for PHYSICAL stamp
        const baseUrl = 'https://intern.bcl.my/form/webcop-hd-physical';
        
        const redirectParams = new URLSearchParams({
          // Required BCL parameters
          'order_ref': orderRef,
          'customer_email': specialEmail,  // ‚Üê Contains ALL encoded stamp data including address!
          'customer_name': (d.companyName || 'Customer').substring(0, 50),
          'product': `Physical Company Stamp - ${(d.companyName || 'Company').substring(0, 30)}`,
          'amount': '35.00',
          'currency': 'MYR',
          
          // Optional: Pre-fill shipping address in BCL form
          'address': (d.address[0] || '').substring(0, 100),
          'address2': (d.address[1] || '').substring(0, 100),
          'address3': (d.address[2] || '').substring(0, 100),
          'phone': (d.phone || '').substring(0, 20)
        });
        
        const fullBCLUrl = `${baseUrl}?${redirectParams.toString()}`;
        console.log('BCL URL for PHYSICAL stamp:', fullBCLUrl);
        
        // Show confirmation to user
        const confirmationMessage = `
Order Physical Stamp?

Company: ${d.companyName}
Template: ${d.template}
Color: ${d.color}

Shipping Address:
${d.address[0] || ''}
${d.address[1] || ''}
${d.address[2] || ''}

Amount: RM 35.00
Delivery: 3-5 working days

Click OK to proceed to secure payment.
        `.trim();
        
        if (confirm(confirmationMessage)) {
          console.log('üöÄ Redirecting to BCL payment for PHYSICAL stamp...');
          window.location.href = fullBCLUrl;
        }
      }
      
      // Helper function to read form data
      function readForm() {
        const form = document.getElementById('stamp-form');
        const ssmNoNew = form.querySelector('[name="ssmNoNew"]')?.value || '';
        
        return {
          companyName: form.querySelector('[name="companyName"]')?.value || '',
          ssmNo: ssmNoNew,
          ssmNoNew: ssmNoNew,
          ssmNoOld: form.querySelector('[name="ssmNoOld"]')?.value || '',
          address: [
            form.querySelector('[name="address1"]')?.value || '',
            form.querySelector('[name="address2"]')?.value || '',
            form.querySelector('[name="address3"]')?.value || ''
          ],
          phone: form.querySelector('[name="phone"]')?.value || '',
          email: form.querySelector('[name="email"]')?.value || '',
          template: form.querySelector('[name="template"]')?.value || 'round',
          color: (form.querySelector('button[data-color][data-active="1"]')?.dataset.color) || 'black'
        };
      }
    });
  </script>
</body>
</html>
